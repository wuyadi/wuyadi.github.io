{"posts":[{"fileName":"lesslesszhi-zhi-liao-greatergreater-xuan-ke-jiong","abstract":"","description":"闭嘴！ 说你呢 高高在上 一片聒噪声 平添几分燥热 自以为聪明 肥头大耳 土堆里 蛰伏 5 年以上 才爬出阴间 却只会用屁股 唱夏日里的赞歌 不知人间疾苦酷暑! ...","title":"《致知了》                                                                         -宣克炅","tags":[],"feature":"https://wuyadi.github.io/post-images/lesslesszhi-zhi-liao-greatergreater-xuan-ke-jiong.jpeg","link":"https://wuyadi.github.io/post/lesslesszhi-zhi-liao-greatergreater-xuan-ke-jiong/","stats":{"text":"1 min read","time":12000,"words":64,"minutes":1},"isTop":false,"toc":"","date":"2022-07-18 19:34:07","dateFormat":"2022-07-18"},{"fileName":"2021-nian-zhong-zong-jie","abstract":"","description":"代码方面 由phper到javaer，现在是一个高级的phper+中级的javaer。换了语言之后，微服务的方案就可以顺理成章的安排上。拆出了exam，base，train，等等模块，在客户环境上线也没有问题，解耦极大地提升了代码的优雅程度...","title":"2021年终总结","tags":[{"name":"总结","slug":"jfAcg2PaH","used":true,"link":"https://wuyadi.github.io/tag/jfAcg2PaH/"},{"name":"随笔","slug":"miO2Lc0qGb","used":true,"link":"https://wuyadi.github.io/tag/miO2Lc0qGb/"}],"feature":"https://wuyadi.github.io/post-images/2021-nian-zhong-zong-jie.jpg","link":"https://wuyadi.github.io/post/2021-nian-zhong-zong-jie/","stats":{"text":"2 min read","time":84000,"words":410,"minutes":2},"isTop":true,"toc":"<ul class=\"markdownIt-TOC\">\n<li><a href=\"#%E4%BB%A3%E7%A0%81%E6%96%B9%E9%9D%A2\">代码方面</a></li>\n<li><a href=\"#%E7%AE%A1%E7%90%86%E6%96%B9%E9%9D%A2\">管理方面</a></li>\n<li><a href=\"#%E7%94%9F%E6%B4%BB%E6%96%B9%E9%9D%A2\">生活方面</a></li>\n<li><a href=\"#%E6%80%BB%E7%BB%93\">总结</a></li>\n</ul>\n","date":"2022-01-03 12:59:31","dateFormat":"2022-01-03"},{"fileName":"older","abstract":"<p>I used to shut my door while my mother screamed in the kitchen<br>\nI'd turn the music up, get high and try not to listen<br>\nTo every little fight, 'cause neither one was right</p>\n<p>I swore I'd never be like them<br>\nBut I was just a kid back then</p>\n<p>The older I get the more that I see<br>\nMy parents aren't heroes, they're just like me<br>\nAnd loving is hard, it don't always work<br>\nYou just try your best not to get hurt<br>\nI used to be mad but now I know<br>\nSometimes it's better to let someone go<br>\nIt just hadn't hit me yet<br>\nThe older I get</p>\n<p>I used to wonder why, why they could never be happy<br>\nI used to close my eyes and pray for a whole 'nother family<br>\nWhere everything was fine, one that felt like mine</p>\n<p>I swore I'd never be like them<br>\nBut I was just a kid back then</p>\n<p>The older I get the more that I see<br>\nMy parents aren't heroes, they're just like me<br>\nAnd loving is hard, it don't always work<br>\nYou just try your best not to get hurt<br>\nI used to be mad but now I know<br>\nSometimes it's better to let someone go<br>\nIt just hadn't hit me yet<br>\nThe older I get</p>\n<p>The older I get the more that I see</p>\n","description":"I used to shut my door while my mother screamed in the kitchen I'd turn the music up, get high and try not to listen To ...","title":"Older","tags":[],"feature":"https://wuyadi.github.io/post-images/older.jpg","link":"https://wuyadi.github.io/post/older/","stats":{"text":"2 min read","time":110000,"words":295,"minutes":2},"isTop":false,"toc":"","date":"2021-12-16 09:32:18","dateFormat":"2021-12-16"},{"fileName":"yong-python-jiao-ben-shan-chu-wu-xiao-redis-key","abstract":"<p>这天运维找我反馈说zgyh这个客户的redis内存越来越高，让我们先自查下是否有程序不合理的一直往redis写key。<br>\n在排查了java go python 和php 的代码后，我信心满满的给了他一个key的列表和统计计数的脚本</p>\n<pre><code class=\"language-shell\">#!/bin/bash\n\nA=$0\nB=${A##*/}\nC=${B%.*}\nrunning_file_name=$C\nrunning_flag=&quot;run.$running_file_name&quot;\n\nREDIS_CLIENT='redis-cli -a xxxx -x'\nfunction process {\n    echo $0\n    index=-1\n    count=0\n    step=100000\n    while ((index!=0))\n    do\n      if [ $index -le 0 ];then\n        index=0\n      fi\n      echo &quot;scan $index match $1 count $step&quot; | $REDIS_CLIENT &gt; $running_file_name.cache\n      read index &lt;&lt;&lt; `head -1 $running_file_name.cache`\n      read inc &lt;&lt;&lt; `cat $running_file_name.cache | wc -l`\n      inc=$((inc - 1))\n      if [ $? -ne 0 ];then\n        break\n      fi\n      count=$((count + inc))\n    done\n    echo &quot;$1 count:&quot;$count\n}\n#\nif [ $# -ne 1 ];then\n    echo &quot;$0 &lt;pars&gt;&quot;\n    exit 0\nfi\n#\nif [ -f &quot;$running_flag&quot; ] ; then\n    echo &quot;is running...&quot;\n    exit 0\nfi\n#\ntouch $running_flag\n#\necho &quot;processing....&quot;\necho $*\nprocess $*\n#\nrm -rf $running_flag\n#\necho &quot;ok!&quot;\n</code></pre>\n<p>和查bigkey的方法</p>\n<pre><code class=\"language-shell\">redis-cli -c -p 6379  -a 密码  --bigkeys \n</code></pre>\n<p>运维反馈bigkeys因为版本问题访问不了，根据我提供的业务key查的数量最大的也就W。但是现在生产的key已经达到了几百W。</p>\n<p>过了几天，运维反馈说找到了那些幽灵的key，是32位的随机字幕+数字，没有赋值，最要命的是没有设置过期时间且确定是从我们的服务机器发出的请求。</p>\n<p>再次走查代码，依旧没有头绪，测试环境的redis环境也没有这些奇怪的key。殚思竭虑两天后，猛地想起这个数据格式和php的session_id很类似。于是检查php的入口方法，果然找到问题。</p>\n<pre><code class=\"language-php\">        $time = $this-&gt;isSession();\n        if ($this-&gt;skipCheck) return true;\n</code></pre>\n<p>这个isSession方法</p>\n<pre><code class=\"language-php\">    protected function isSession() {\n        if ($this-&gt;AccessField == 'FILE') {\n            return $this-&gt;isFSession();\n        } else {\n            return $this-&gt;isRSession();\n        }\n    }\n</code></pre>\n<p>在类型不是FILE的情况下会走isRSession</p>\n<pre><code class=\"language-php\">    private function isRSession() {\n        $PHPSESSID = $_COOKIE['PHPSESSID'];\n        if (empty($PHPSESSID)) {\n            return;\n        }\n\n        $data = S($PHPSESSID);\n\n        if (empty($data)) {\n            return;\n        }\n        /*从缓存服务器同步到本地*/\n        if ($data['SYNCH']) {\n            $data = array(\n                &quot;DATA&quot; =&gt; $data['DATA'],\n                &quot;EXPIRE&quot; =&gt; time(),\n                &quot;REGIST&quot; =&gt; time()\n            );\n            $data['SYNCH'] = false;\n            /*更新缓存服务器状态*/\n        }\n\n        if (!empty($_SESSION[$this-&gt;AccessName])) {\n            /*已同步到现在的服务器上*/\n            return $_SESSION[$this-&gt;AccessName]['EXPIRE'];\n        }\n\n    }\n</code></pre>\n<p>问题就出在S($PHPSESSID)这句，S方法内容如下</p>\n<pre><code class=\"language-php\">function S($name,$value='',$options=null) {\n    static $cache   =   '';\n    if(strtoupper(C('DATA_CACHE_TYPE')) == 'REDISMS'){\n        $cache = Think\\Cache\\Driver\\Redisms::getInstance();\n        if(''=== $value){ // 获取缓存\n            return $cache-&gt;get($name);\n        }elseif(is_null($value)) { // 删除缓存\n            return $cache-&gt;rm($name);\n        }else{\n            if(is_array($options)) {\n                $expire     =   isset($options['expire'])?$options['expire']:NULL;\n            }else{\n                $expire     =   is_numeric($options)?$options:NULL;\n            }\n            return $cache-&gt;set($name, $value, $expire);\n        }\n    }\n\n    if(is_array($options)){\n        // 缓存操作的同时初始化\n        $type       =   isset($options['type'])?$options['type']:'';\n        $cache      =   Think\\Cache::getInstance($type,$options);\n    }elseif(is_array($name)) { // 缓存初始化\n        $type       =   isset($name['type'])?$name['type']:'';\n        $cache      =   Think\\Cache::getInstance($type,$name);\n        return $cache;\n    }elseif(empty($cache)) { // 自动初始化\n        $cache      =   Think\\Cache::getInstance();\n    }\n    if(''=== $value){ // 获取缓存\n        return $cache-&gt;get($name);\n    }elseif(is_null($value)) { // 删除缓存\n        return $cache-&gt;rm($name);\n    }else { // 缓存数据\n        if(is_array($options)) {\n            $expire     =   isset($options['expire'])?$options['expire']:NULL;\n        }else{\n            $expire     =   is_numeric($options)?$options:NULL;\n        }\n        return $cache-&gt;set($name, $value, $expire);\n    }\n}\n</code></pre>\n<p>坏就坏在这边没有缓存会去set Memcache.class.php创建缓存的代码;</p>\n<pre><code class=\"language-php\">\tpublic function write($sessID, $sessData) {\n\t\treturn $this-&gt;handle-&gt;set($this-&gt;sessionName.$sessID, $sessData, 0, $this-&gt;lifeTime);\n\t}\n</code></pre>\n<p>$this-&gt;lifeTime取得</p>\n<pre><code class=\"language-php\">protected $lifeTime     = 3600;\n\tprotected $sessionName  = '';\n\tprotected $handle       = null;\n\n    /**\n     * 打开Session \n     * @access public \n     * @param string $savePath \n     * @param mixed $sessName  \n     */\n\tpublic function open($savePath, $sessName) {\n\t\t$this-&gt;lifeTime     = C('SESSION_EXPIRE') ? C('SESSION_EXPIRE') : $this-&gt;lifeTime;\n</code></pre>\n<p>好死不死，配置中SESSION_EXPIRE是0。所以<strong>改配置中SESSION_EXPIRE，确保后续数据的及时清理。</strong></p>\n<p>但是之前redis中key怎么清理呢。找了下轮子没有现成的，写了一个python 的脚本</p>\n<pre><code class=\"language-python\">import redis\n\n# 匹配test:开头[0-9]结尾的key\nprefix = '*'\nconn = redis.Redis(host = '172.20.199.5', port=6379, password=&quot;***&quot;)\ni = 0\ns = 0\nfor key in conn.scan_iter(match=prefix, count=1000):\n    ttltime = conn.ttl(key)\n    i = i + 1\n    if( (ttltime is None or ttltime == -1) and len(key) == 32 and conn.type(key).decode() == 'string' and not conn.get(key)):\n        # 删除匹配到的没有过期时间的key\n        print(key, ' - value =', conn.get(key))       \n        print(key, ' - key =', conn.type(key))\n        conn.delete(key)\n        s = s + 1\n        print(key, ' - del number=', s)\n        \n\nprint('total key', i,' -&gt; del ',s)\n\n</code></pre>\n<p>完美。今天小雪 晚来天欲雪，能饮一杯无？</p>\n","description":"这天运维找我反馈说zgyh这个客户的redis内存越来越高，让我们先自查下是否有程序不合理的一直往redis写key。 在排查了java go python 和php 的代码后，我信心满满的给了他一个key的列表和统计计数的脚本 #!/bi...","title":"用python脚本删除无效redis key","tags":[{"name":"python","slug":"sggYxhSZT","used":true,"link":"https://wuyadi.github.io/tag/sggYxhSZT/"},{"name":"redis","slug":"GZP9HJESJM","used":true,"link":"https://wuyadi.github.io/tag/GZP9HJESJM/"},{"name":"默认缓存","slug":"UDOoZH-vj5","used":true,"link":"https://wuyadi.github.io/tag/UDOoZH-vj5/"}],"feature":"https://wuyadi.github.io/post-images/yong-python-jiao-ben-shan-chu-wu-xiao-redis-key.png","link":"https://wuyadi.github.io/post/yong-python-jiao-ben-shan-chu-wu-xiao-redis-key/","stats":{"text":"5 min read","time":292000,"words":994,"minutes":5},"isTop":false,"toc":"","date":"2021-11-22 19:39:23","dateFormat":"2021-11-22"},{"fileName":"chen-nian-xi-lesslessshuang-yu-tong-jing-greatergreater","abstract":"","description":"这面铜镜据说产自金代 它有着北方浓烈的质地 两尾鲤鱼一直活着 它们游向恩爱 游向朝代深处 它曾经悬于闺室 映过一张姣好的颜容 她的亲人耽于征战 策马长城 或埋骨于雨定河边 如今 一面镜子沉默不语 它一路经过的村庄 风雨 兴亡 被穿窗而至的一...","title":"陈年喜 ·《双鱼铜镜》","tags":[],"feature":"","link":"https://wuyadi.github.io/post/chen-nian-xi-lesslessshuang-yu-tong-jing-greatergreater/","stats":{"text":"1 min read","time":54000,"words":273,"minutes":1},"isTop":false,"toc":"","date":"2021-09-16 09:24:03","dateFormat":"2021-09-16"},{"fileName":"di-xiao-neng-cheng-xu-yuan-de-xing-wei-yu-si-wei-gong-mian","abstract":"","description":" 不写单元测试。 不主动学习，不看书。 总是拿没时间作为借口。 不会做任务拆解，也没有记录拆解的任务。 做事没耐心。 不 Review 自己的代码，做过的事情，犯的错误。 从不了解架构，不了解设计（设计就是架构）。 不了解敏捷开发，更没有想...","title":"低效能程序员的行为与思维，共勉","tags":[],"feature":"https://wuyadi.github.io/post-images/di-xiao-neng-cheng-xu-yuan-de-xing-wei-yu-si-wei-gong-mian.jpg","link":"https://wuyadi.github.io/post/di-xiao-neng-cheng-xu-yuan-de-xing-wei-yu-si-wei-gong-mian/","stats":{"text":"3 min read","time":172000,"words":836,"minutes":3},"isTop":false,"toc":"","date":"2021-09-11 16:44:32","dateFormat":"2021-09-11"},{"fileName":"with-great-power-comes-great-responsibility","abstract":"","description":"蜘蛛侠的叔叔曾经说过：能力越大，责任越大。 以我国是按劳分配为大前提， 则推导出：赚钱越多，劳动越多。 而大家都是每天只有 24 小时的人，能劳动越多，说明能力越大。 即推导出：赚的越多，责任越大。 比如年轻人月收入一万，已经算不错的了吧，...","title":"With great power comes great responsibility","tags":[{"name":"有趣的文章","slug":"QbYQ1jxNc","used":true,"link":"https://wuyadi.github.io/tag/QbYQ1jxNc/"}],"feature":"https://wuyadi.github.io/post-images/with-great-power-comes-great-responsibility.webp","link":"https://wuyadi.github.io/post/with-great-power-comes-great-responsibility/","stats":{"text":"3 min read","time":178000,"words":879,"minutes":3},"isTop":false,"toc":"","date":"2021-08-30 11:30:22","dateFormat":"2021-08-30"},{"fileName":"dai-ma-gui-fan-yuan-ze","abstract":"","description":"Keep it Simple and Stupid 原则 在设计、制造当中以简约、简单为标准。因为简约、简单，才易于生产，易于维护，更易于操作 要谦虚，不要认为自己是个天才 将你的任务分解为4-12小时的子任务。 把你的问题...","title":"代码规范原则","tags":[],"feature":"https://wuyadi.github.io/post-images/dai-ma-gui-fan-yuan-ze.png","link":"https://wuyadi.github.io/post/dai-ma-gui-fan-yuan-ze/","stats":{"text":"2 min read","time":81000,"words":395,"minutes":2},"isTop":false,"toc":"<ul class=\"markdownIt-TOC\">\n<li>\n<ul>\n<li>\n<ul>\n<li><a href=\"#keep-it-simple-and-stupid-%E5%8E%9F%E5%88%99\">Keep it Simple and Stupid 原则</a></li>\n<li><a href=\"#dry%E5%8E%9F%E5%88%99\">DRY原则</a></li>\n<li><a href=\"#%E7%BB%84%E5%90%88%E5%8E%9F%E5%88%99\">组合原则</a></li>\n<li><a href=\"#%E9%80%9A%E4%BF%97%E5%8E%9F%E5%88%99\">通俗原则</a></li>\n<li><a href=\"#%E5%90%9D%E5%95%AC%E5%8E%9F%E5%88%99\">吝啬原则</a></li>\n<li><a href=\"#%E9%80%8F%E6%98%8E%E6%80%A7%E5%8E%9F%E5%88%99\">透明性原则</a></li>\n<li><a href=\"#%E8%A1%A5%E6%95%91%E5%8E%9F%E5%88%99\">补救原则</a></li>\n<li><a href=\"#%E7%BC%84%E9%BB%98%E5%8E%9F%E5%88%99\">缄默原则</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n","date":"2021-06-17 16:57:28","dateFormat":"2021-06-17"},{"fileName":"guan-yu-gao-ji-cheng-xu-yuan-de-si-kao-v_v","abstract":"","description":"这周面试了一个工作了11年的前辈，整个面试过程情绪波动比较大，感触良多。 以下是面试老哥的部分简历： 刚开始面试的时候我是有点虚的，毕竟眼前的这位可能是一个大佬。但是随着交流我发现事情并不简单。 后端知识点：jvm的相关知识点答得含糊...","title":"关于高级程序员的思考(ˇˍˇ)","tags":[{"name":"java","slug":"ug9lKhdOO","used":true,"link":"https://wuyadi.github.io/tag/ug9lKhdOO/"},{"name":"面试","slug":"l-ypQzqK7","used":true,"link":"https://wuyadi.github.io/tag/l-ypQzqK7/"}],"feature":"https://wuyadi.github.io/post-images/guan-yu-gao-ji-cheng-xu-yuan-de-si-kao-v_v.jpg","link":"https://wuyadi.github.io/post/guan-yu-gao-ji-cheng-xu-yuan-de-si-kao-v_v/","stats":{"text":"2 min read","time":102000,"words":472,"minutes":2},"isTop":false,"toc":"<ul class=\"markdownIt-TOC\">\n<li>\n<ul>\n<li>\n<ul>\n<li>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%E4%BB%A5%E4%B8%8B%E6%98%AF%E9%9D%A2%E8%AF%95%E8%80%81%E5%93%A5%E7%9A%84%E9%83%A8%E5%88%86%E7%AE%80%E5%8E%86\">以下是面试老哥的部分简历：</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n","date":"2021-03-12 20:13:46","dateFormat":"2021-03-12"},{"fileName":"zuo-mian-shi-guan-yi-zhou-you-gan","abstract":"","description":"因为公司在996之后，任务量还是没有完全的消化。领导决定给我们组添加两个同事儿，然后让我作为初面面试官。然后我开始了诚惶诚恐的面试官体验。 首先是简历的筛选，真的是五味杂陈。 有的同学写了很多公司的项目，但是通篇都是业务的内容，没有体现自...","title":"做面试官一周有感","tags":[{"name":"面试","slug":"l-ypQzqK7","used":true,"link":"https://wuyadi.github.io/tag/l-ypQzqK7/"},{"name":"随笔","slug":"miO2Lc0qGb","used":true,"link":"https://wuyadi.github.io/tag/miO2Lc0qGb/"}],"feature":"https://wuyadi.github.io/post-images/zuo-mian-shi-guan-yi-zhou-you-gan.jpg","link":"https://wuyadi.github.io/post/zuo-mian-shi-guan-yi-zhou-you-gan/","stats":{"text":"2 min read","time":73000,"words":368,"minutes":2},"isTop":false,"toc":"<ul class=\"markdownIt-TOC\">\n<li>\n<ul>\n<li>\n<ul>\n<li>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%E4%BB%A5%E4%BA%BA%E4%B8%BA%E9%89%B4%E5%8F%AF%E4%BB%A5%E7%9F%A5%E5%BE%97%E5%A4%B1-%E4%BA%89%E5%8F%96%E5%9C%A8%E4%BB%A5%E5%90%8E%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%92%8C%E7%94%9F%E6%B4%BB%E4%B8%AD%E4%B8%8D%E8%A6%81%E7%8A%AF%E4%BB%A5%E4%B8%8A%E7%9A%84%E8%BF%99%E7%A7%8D%E9%94%99%E8%AF%AF%E5%B0%8F%E9%94%99%E8%AF%AF%E5%95%8A\">以人为鉴,可以知得失。争取在以后的工作和生活中不要犯以上的这种错误，小错误啊。</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n","date":"2020-09-18 20:47:26","dateFormat":"2020-09-18"},{"fileName":"php-dao-chu-zui-zhong-zhang","abstract":"","description":"产品新上了一个标注平台，主要功能是，标注asr识别不准的文字，然后重新提交训练提高asr 的识别准确率。然后业务那边提了一个导出错误和正确文本对比的需求，听起来实现很容易，然后业务又说，错误的文本要用颜色标红区分出来。这个听起来也不难，同事...","title":"php导出最终章","tags":[{"name":"XLSXWriter","slug":"Cgj5zKr2Y","used":true,"link":"https://wuyadi.github.io/tag/Cgj5zKr2Y/"},{"name":"excel","slug":"vgdkEtpzM8","used":true,"link":"https://wuyadi.github.io/tag/vgdkEtpzM8/"},{"name":"php","slug":"3WTMsKTgK","used":true,"link":"https://wuyadi.github.io/tag/3WTMsKTgK/"}],"feature":"https://wuyadi.github.io/post-images/php-dao-chu-zui-zhong-zhang.png","link":"https://wuyadi.github.io/post/php-dao-chu-zui-zhong-zhang/","stats":{"text":"3 min read","time":175000,"words":614,"minutes":3},"isTop":false,"toc":"","date":"2020-09-11 21:33:21","dateFormat":"2020-09-11"},{"fileName":"qi-guai-de-bug","abstract":"","description":"前情： 在更新了一个数据权限的模块之后，测试同学说有个权限的bug。在检查代码后，发现了罪魁祸首。 开始： $keys = ['callerNum','calleeNum','agentName','agentID','customer_...","title":"奇怪的bug","tags":[{"name":"php","slug":"3WTMsKTgK","used":true,"link":"https://wuyadi.github.io/tag/3WTMsKTgK/"},{"name":"bug","slug":"zTuC-f5CwN","used":true,"link":"https://wuyadi.github.io/tag/zTuC-f5CwN/"}],"feature":"https://wuyadi.github.io/post-images/qi-guai-de-bug.jpg","link":"https://wuyadi.github.io/post/qi-guai-de-bug/","stats":{"text":"2 min read","time":61000,"words":242,"minutes":2},"isTop":false,"toc":"<ul class=\"markdownIt-TOC\">\n<li>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%E5%89%8D%E6%83%85\">前情：</a></li>\n<li><a href=\"#%E5%BC%80%E5%A7%8B\">开始：</a></li>\n<li><a href=\"#%E5%88%86%E6%9E%90\">分析：</a></li>\n<li><a href=\"#%E7%BB%93%E8%AE%BA\">结论：</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n","date":"2020-07-23 14:43:58","dateFormat":"2020-07-23"},{"fileName":"cong-php-dao-go-zhi-dao-chu-shu-ju","abstract":"","description":"前情： 生产环境有客户经常从ES中导出不同时段的数据，一天数据大概有12W，现有的php导出速度在优化之后一次导出耗时需要27-35分钟，所以有了这次优化。 开始： HBASE + ES 因为现在的主要耗时在于从es获取数据时的耗时比较久，...","title":"从PHP到GO之导出数据","tags":[{"name":"go","slug":"L0LTP3V10","used":true,"link":"https://wuyadi.github.io/tag/L0LTP3V10/"},{"name":"excel","slug":"vgdkEtpzM8","used":true,"link":"https://wuyadi.github.io/tag/vgdkEtpzM8/"},{"name":"性能","slug":"U6CteJZ65O","used":true,"link":"https://wuyadi.github.io/tag/U6CteJZ65O/"},{"name":"php","slug":"3WTMsKTgK","used":true,"link":"https://wuyadi.github.io/tag/3WTMsKTgK/"}],"feature":"https://wuyadi.github.io/post-images/cong-php-dao-go-zhi-dao-chu-shu-ju.jpg","link":"https://wuyadi.github.io/post/cong-php-dao-go-zhi-dao-chu-shu-ju/","stats":{"text":"2 min read","time":110000,"words":436,"minutes":2},"isTop":false,"toc":"<ul class=\"markdownIt-TOC\">\n<li>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%E5%89%8D%E6%83%85\">前情：</a></li>\n<li><a href=\"#%E5%BC%80%E5%A7%8B\">开始：</a>\n<ul>\n<li><a href=\"#hbase-es\">HBASE + ES</a></li>\n<li><a href=\"#%E4%BB%8Ephp%E5%88%B0golang\">从PHP到Golang</a></li>\n</ul>\n</li>\n<li><a href=\"#%E7%BB%93%E8%AE%BA\">结论：</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n","date":"2020-03-25 20:57:13","dateFormat":"2020-03-25"},{"fileName":"phpexcel-xing-neng-ping-jing-ji-qi-you-hua-ii","abstract":"","description":"前情： 再回头复查的时候，发现我始终局限于使用ExcelUtil或者 PhpSpreadsheet ，我们就算分批取数据，但是excel本身的内存占用还是会累积，一个100W数据的导出，还是会引起服务器的内存溢出。 开始： 有网友推荐使用 ...","title":"phpexcel性能瓶颈及其优化 III","tags":[{"name":"XLSXWriter","slug":"Cgj5zKr2Y","used":true,"link":"https://wuyadi.github.io/tag/Cgj5zKr2Y/"},{"name":"excel","slug":"vgdkEtpzM8","used":true,"link":"https://wuyadi.github.io/tag/vgdkEtpzM8/"},{"name":"php","slug":"3WTMsKTgK","used":true,"link":"https://wuyadi.github.io/tag/3WTMsKTgK/"}],"feature":"https://wuyadi.github.io/post-images/phpexcel-xing-neng-ping-jing-ji-qi-you-hua-ii.png","link":"https://wuyadi.github.io/post/phpexcel-xing-neng-ping-jing-ji-qi-you-hua-ii/","stats":{"text":"1 min read","time":47000,"words":222,"minutes":1},"isTop":false,"toc":"<ul class=\"markdownIt-TOC\">\n<li>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%E5%89%8D%E6%83%85\">前情：</a></li>\n<li><a href=\"#%E5%BC%80%E5%A7%8B\">开始：</a></li>\n<li><a href=\"#%E5%88%86%E6%9E%90\">分析：</a></li>\n<li><a href=\"#%E7%BB%93%E8%AE%BA\">结论：</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n","date":"2020-03-22 20:05:39","dateFormat":"2020-03-22"},{"fileName":"phpexcel-xing-neng-ping-jing-ji-qi-you-hua-i","abstract":"","description":"前情： 前面简单的优化了导出的报错以及资源限制，这两天来复查的时候，发现导出数量达到1W的时候 ，导出速度就会越来越慢。简单的盘一下。 开始： 代码如下： if (!empty($param['tag_name'])) { ...","title":"phpexcel性能瓶颈及其优化 II","tags":[{"name":"excel","slug":"vgdkEtpzM8","used":true,"link":"https://wuyadi.github.io/tag/vgdkEtpzM8/"},{"name":"性能","slug":"U6CteJZ65O","used":true,"link":"https://wuyadi.github.io/tag/U6CteJZ65O/"},{"name":"php","slug":"3WTMsKTgK","used":true,"link":"https://wuyadi.github.io/tag/3WTMsKTgK/"}],"feature":"https://wuyadi.github.io/post-images/phpexcel-xing-neng-ping-jing-ji-qi-you-hua-i.png","link":"https://wuyadi.github.io/post/phpexcel-xing-neng-ping-jing-ji-qi-you-hua-i/","stats":{"text":"2 min read","time":119000,"words":413,"minutes":2},"isTop":false,"toc":"<ul class=\"markdownIt-TOC\">\n<li>\n<ul>\n<li>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%E5%89%8D%E6%83%85\"><strong>前情：</strong></a></li>\n<li><a href=\"#%E5%BC%80%E5%A7%8B\"><strong>开始：</strong></a></li>\n<li><a href=\"#%E5%88%86%E6%9E%90\"><strong>分析：</strong></a></li>\n<li><a href=\"#%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3\">问题解决</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n","date":"2019-07-11 20:46:04","dateFormat":"2019-07-11"},{"fileName":"phpexcel-xing-neng-ping-jing-ji-qi-you-hua","abstract":"","description":"PHP导出excel常见报错 导出报错 Fatal error: Out of memory Fatal error: Out of memory (allocated 1048576) (tried to allocate 393216 ...","title":"phpexcel性能瓶颈及其优化 I","tags":[{"name":"excel","slug":"vgdkEtpzM8","used":true,"link":"https://wuyadi.github.io/tag/vgdkEtpzM8/"},{"name":"php","slug":"3WTMsKTgK","used":true,"link":"https://wuyadi.github.io/tag/3WTMsKTgK/"}],"feature":"https://wuyadi.github.io/post-images/phpexcel-xing-neng-ping-jing-ji-qi-you-hua.png","link":"https://wuyadi.github.io/post/phpexcel-xing-neng-ping-jing-ji-qi-you-hua/","stats":{"text":"2 min read","time":67000,"words":291,"minutes":2},"isTop":false,"toc":"<ul class=\"markdownIt-TOC\">\n<li>\n<ul>\n<li><a href=\"#php%E5%AF%BC%E5%87%BAexcel%E5%B8%B8%E8%A7%81%E6%8A%A5%E9%94%99\">PHP导出excel常见报错</a>\n<ul>\n<li><a href=\"#%E5%AF%BC%E5%87%BA%E6%8A%A5%E9%94%99-fatal-error-out-of-memory\">导出报错 Fatal error: Out of memory</a></li>\n<li><a href=\"#%E5%AF%BC%E5%87%BA%E6%8A%A5%E9%94%99-502bad-gateway\">导出报错 502bad gateway</a></li>\n<li><a href=\"#%E5%AF%BC%E5%87%BA%E6%8A%A5%E9%94%99-%E8%AF%A5%E7%BD%91%E9%A1%B5%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E8%BF%90%E4%BD%9C-%E7%9B%AE%E5%89%8D%E6%97%A0%E6%B3%95%E5%A4%84%E7%90%86%E6%AD%A4%E8%AF%B7%E6%B1%82-http-error-500\">导出报错 该网页无法正常运作 目前无法处理此请求。HTTP ERROR 500</a></li>\n</ul>\n</li>\n<li><a href=\"#%E7%94%B1%E4%BB%A5%E4%B8%8A%E6%8A%A5%E9%94%99%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%BE%97%E5%87%BA-php%E7%9A%84%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88%E5%9C%A8%E4%BA%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%80%A7%E8%83%BD%E5%BD%93%E5%AF%BC%E5%87%BA%E6%95%B0%E9%87%8F%E5%A4%A7%E4%BA%8E1w%E6%9D%A1%E7%9A%84%E6%97%B6%E5%80%99%E9%9A%8F%E7%9D%80php%E4%BD%BF%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%86%85%E5%AD%98%E7%9A%84%E5%A2%9E%E5%8A%A0%E5%AF%BC%E5%87%BA%E9%80%9F%E5%BA%A6%E5%9C%A8%E7%9B%B8%E5%BA%94%E7%9A%84%E4%B8%8B%E9%99%8D\">由以上报错我们可以得出 php的性能瓶颈在于服务器性能，当导出数量大于1W条的时候，随着PHP使用服务器内存的增加，导出速度在相应的下降。</a></li>\n<li><a href=\"#php%E5%AF%BC%E5%87%BAexcel%E7%9A%84%E4%BC%98%E5%8C%96\">PHP导出EXCEL的优化</a>\n<ul>\n<li><a href=\"#%E4%B8%8D%E8%A6%81%E5%9C%A8%E5%86%99%E5%85%A5excel%E7%9A%84%E6%97%B6%E5%80%99%E8%BF%9B%E8%A1%8C%E8%AE%A1%E7%AE%97\">不要在写入EXCEL的时候进行计算</a></li>\n<li><a href=\"#%E4%B8%8D%E8%A6%81%E5%86%8D%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9A%84%E6%97%B6%E5%80%99%E8%AE%BE%E7%BD%AE%E5%8D%95%E5%85%83%E6%A0%BC%E6%A0%B7%E5%BC%8F\">不要再大数据的时候设置单元格样式</a></li>\n<li><a href=\"#%E5%88%86%E6%89%B9%E6%AC%A1%E5%86%99%E5%85%A5\">分批次写入</a></li>\n<li><a href=\"#%E4%BD%BF%E7%94%A8phpexcel_settingssetcachestoragemethod-%E9%99%8D%E4%BD%8E%E7%A8%8B%E5%BA%8F%E5%AF%B9%E5%86%85%E5%AD%98%E7%9A%84%E6%B6%88%E8%80%97\">使用PHPExcel_Settings::setCacheStorageMethod() 降低程序对内存的消耗</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n","date":"2019-02-02 10:25:10","dateFormat":"2019-02-02"},{"fileName":"chou-xiang-lei-jie-kou-de-ding-yi-qu-bie-he-shi-yong-chang-jing","abstract":"","description":"抽象类的定义 PHP 5 支持抽象类和抽象方法。定义为抽象的类不能被实例化。任何一个类，如果它里面至少有一个方法是被声明为抽象的，那么这个类就必须被声明为抽象的。被定义为抽象的方法只是声明了其调用方式（参数），不能定义其具体的功能实现。 继...","title":"抽象类、接口的定义、区别和使用场景","tags":[],"feature":"https://wuyadi.github.io/post-images/chou-xiang-lei-jie-kou-de-ding-yi-qu-bie-he-shi-yong-chang-jing.jpg","link":"https://wuyadi.github.io/post/chou-xiang-lei-jie-kou-de-ding-yi-qu-bie-he-shi-yong-chang-jing/","stats":{"text":"3 min read","time":128000,"words":626,"minutes":3},"isTop":false,"toc":"<ul class=\"markdownIt-TOC\">\n<li>\n<ul>\n<li><a href=\"#%E6%8A%BD%E8%B1%A1%E7%B1%BB%E7%9A%84%E5%AE%9A%E4%B9%89\">抽象类的定义</a></li>\n<li><a href=\"#%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%AE%9A%E4%B9%89\">接口的定义</a>\n<ul>\n<li><a href=\"#tips\">TIPS</a></li>\n</ul>\n</li>\n<li><a href=\"#%E6%8A%BD%E8%B1%A1%E7%B1%BB%E5%92%8C%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%8C%BA%E5%88%AB\">抽象类和接口的区别</a></li>\n</ul>\n</li>\n</ul>\n","date":"2018-09-09 17:34:27","dateFormat":"2018-09-09"}],"tags":[{"name":"总结","slug":"jfAcg2PaH","used":true,"link":"https://wuyadi.github.io/tag/jfAcg2PaH/","count":1},{"name":"随笔","slug":"miO2Lc0qGb","used":true,"link":"https://wuyadi.github.io/tag/miO2Lc0qGb/","count":2},{"name":"python","slug":"sggYxhSZT","used":true,"link":"https://wuyadi.github.io/tag/sggYxhSZT/","count":1},{"name":"redis","slug":"GZP9HJESJM","used":true,"link":"https://wuyadi.github.io/tag/GZP9HJESJM/","count":1},{"name":"默认缓存","slug":"UDOoZH-vj5","used":true,"link":"https://wuyadi.github.io/tag/UDOoZH-vj5/","count":1},{"name":"有趣的文章","slug":"QbYQ1jxNc","used":true,"link":"https://wuyadi.github.io/tag/QbYQ1jxNc/","count":1},{"name":"java","slug":"ug9lKhdOO","used":true,"link":"https://wuyadi.github.io/tag/ug9lKhdOO/","count":1},{"name":"面试","slug":"l-ypQzqK7","used":true,"link":"https://wuyadi.github.io/tag/l-ypQzqK7/","count":2},{"name":"XLSXWriter","slug":"Cgj5zKr2Y","used":true,"link":"https://wuyadi.github.io/tag/Cgj5zKr2Y/","count":2},{"name":"excel","slug":"vgdkEtpzM8","used":true,"link":"https://wuyadi.github.io/tag/vgdkEtpzM8/","count":5},{"name":"php","slug":"3WTMsKTgK","used":true,"link":"https://wuyadi.github.io/tag/3WTMsKTgK/","count":6},{"name":"bug","slug":"zTuC-f5CwN","used":true,"link":"https://wuyadi.github.io/tag/zTuC-f5CwN/","count":1},{"name":"go","slug":"L0LTP3V10","used":true,"link":"https://wuyadi.github.io/tag/L0LTP3V10/","count":1},{"name":"性能","slug":"U6CteJZ65O","used":true,"link":"https://wuyadi.github.io/tag/U6CteJZ65O/","count":2}],"menus":[{"link":"/","name":"首页","openType":"Internal"},{"link":"/archives","name":"归档","openType":"Internal"},{"link":"/tags","name":"标签","openType":"Internal"},{"link":"/post/about","name":"关于","openType":"Internal"}],"themeConfig":{"themeName":"bitcron-pro","postPageSize":10,"archivesPageSize":50,"siteName":"一个兴趣使然的程序员","siteDescription":"知耻近乎勇","footerInfo":"","showFeatureImage":true,"domain":"https://wuyadi.github.io","postUrlFormat":"SLUG","tagUrlFormat":"SHORT_ID","dateFormat":"YYYY-MM-DD","feedFullText":false,"feedCount":10,"archivesPath":"archives","postPath":"post","tagPath":"tag"},"customConfig":{"Santa":true,"Spring":true,"envelope":"","ga":"","github":"","rss":"","telegram":"","twitter":"","weibo":"","zhihu":""},"utils":{"now":1658144203600}}
